# 第九章：层论 —— 局部与整体的桥梁

> **本章导读**：层是连接「局部信息」和「整体结构」的桥梁。在代数几何中，层无处不在——从坐标环的层到线丛，从上同调到Serre对偶。这一章我们将学习层的基本理论，为后续的代数几何课程打下基础。

---

## 9.1 拓扑空间上的层

### 9.1.1 从局部到整体

在微分几何中，我们学习「在每个点附近给出数据」然后「 glue 起来」。代数几何中同样如此！

**核心思想**：
- 在空间的每个小开集上，给出一些数据
- 当开集相交时，这些数据必须「兼容」
- 把局部兼容的数据「粘起来」得到整体数据

### 9.1.2 预层的

> **预层（Presheaf）** F on 拓扑空间 X 是：
> 1. 对每个开集 U ⊆ X，指定一个集合 F(U)
> 2. 对每个开包含 U ⊆ V（限制映射），指定映射 res_{V,U}: F(V) → F(U)
> 
> 满足：
> - res_{U,U} = id_{F(U)}
> - 若 U ⊆ V ⊆ W，则 res_{W,U} = res_{V,U} ∘ res_{W,V}

```text
例子：连续函数层
- F(U) = {连续函数 f: U → ℝ}
- 限制：从 V 到 U 就是函数的限制

例子：常数预层
- F(U) = 某个固定集合 S
- 限制都是恒等映射

但常数预层通常不是层！
```

### 9.1.3 层的定义

> **层（Sheaf）** 是满足额外「粘合条件」的预层：

1. **局部性**：若 {U_i} 是开覆盖，s ∈ F(U) 且 res_{U,U_i}(s) = 0 对所有 i 成立，则 s = 0
2. **粘合**：若 {U_i} 是开覆盖，s_i ∈ F(U_i) 满足在交叠处兼容，则存在唯一 s ∈ F(U) 使得 res_{U,U_i}(s) = s_i

```text
层 = 预层 + 局部性 + 粘合

例子：连续函数层 C
- 是层：局部定义的连续函数可以粘起来
- 任何层都是预层，但反之不真
```

---

## 9.2 层的例子

### 9.2.1 结构层

> **结构层（Structure Sheaf）** O_X 是代数几何中最重要的层！

```text
在仿射概形 Spec R 上：
- O_X(U) = {局部化后的环的元素在 U 上有定义}
- 实际上：O_X(D(f)) ≅ R_f

在复流形上：
- O_X = 全纯函数层
```

### 9.2.2 常数层

> **常数层（Constant Sheaf）** 给出「全局恒定的数据」。

```text
例子：在 ℝ 上， ℤ 层
- ℤ(U) = {局部常整数函数}
- ℤ(ℝ) = ℤ
- ℤ((0,1)) = ℤ
```

### 9.2.3 更多例子

```text
例子1：自由Abel群层
- F(U) = 自由Abel群在 U 上

例子2：可微函数层
- 在微分流形上，C^∞ 函数层

例子3：微分形式层
- Ω^p = p 次微分形式层
```

---

## 9.3 层的茎

### 9.3.1 茎的定义

> **茎（Stalk）** 在点 x 处的茎是：
> 
> F_x = ⨲_{x∈U} F(U)
> 
> 即所有包含 x 的开集上截面「在 x 处等价」的极限。

```text
直观理解：
- 茎「只看 x 附近的资料」
- 不同点的茎一般不同
- 茎是「局部信息」

例子：连续函数层 C
- C_x = {在 x 附近定义的连续函数}
         （在 x 的任意小邻域有定义的两函数等价）
```

### 9.3.2 茎的结构

```text
例子：结构层 O_X 在点 p
- O_{X,p} = 局部环
- 极大理想 = p 对应的理想
- 剩余域 = k(p)

例子：可微流形上的 C^∞ 层
- C^∞_{M,p} = 在 p 处的芽（germ）
```

### 9.3.3 层的芽

> **芽（Germ）** 是茎中的元素——即在某个邻域有定义的截面 equivalence class。

```text
例子：
- 函数的芽 = 「在 x 附近是什么」的等价类
- 两个函数如果有相同的「在 x 附近的值」，则芽相同
```

---

## 9.4 层的限制与扩张

### 9.4.1 限制

> 若 U ⊆ X 是开集，层 F 在 U 上的**限制** F|_U 是：
> 
> (F|_U)(V) = F(V)，对 V ⊆ U

### 9.4.2 泛性质

> **层化（Sheafification）** 是把预层变成层的最小方法：
> 
> 对任何预层 P，存在层 F 和自然变换 P → F，使得对任何层 G，P → G 唯一因子通过 F。

```text
步骤：
1. 先「分离」预层（强制局部性）
2. 再「粘合」（强制粘合性）

这在代数几何中用于定义层的截面！
```

---

## 9.5 层的态射

### 9.5.1 态射的定义

> 层之间的**态射** φ: F → G 是：
> - 对每个开集 U，映射 φ_U: F(U) → G(U)
> - 满足限制兼容性

```text
图示：
     F(U) ──φ_U──→ G(U)
      │                 │
      │res             │res
      ▼                 ▼
    F(V) ──φ_V──→ G(V)

对 V ⊆ U， diagram 交换
```

### 9.5.2 核与像

> 在层的范畴中，核和像有特殊性质：
> 
> - **核** Ker φ 是层，定义为 (Ker φ)(U) = Ker(φ_U)
> - **像** Im φ 是层化后的预层 Im' φ

> 层的范畴是 **阿贝尔范畴**！

### 9.5.3 层的正合列

> **正合列**：0 → F' → F → F'' → 0
> 
> 在每点茎处正合 ⇔ 整体正合（对于层！）

---

## 9.6 层上同调初步

### 9.6.1 为什么需要上同调？

> 层截面通常不够——我们需要「更高维」的拓扑信息！
> 
> - H⁰(F) = F(X)，整体截面
> - H¹(F) = 障碍类（如何把局部数据粘成整体）
> - 等等...

### 9.6.2 注入 Resolution

> ** injective resolution**：0 → F → I⁰ → I¹ → ...
> 
> 其中每个 I^j 是内射层。

### 9.6.3 层上同调

> **层上同调**：
> 
> H^i(X, F) = H^i(Γ(X, I^*))

```text
计算层上同调的方法：
1. Čech 上同调
2. Godement 消解
3. 平展上同调（代数几何的标准方法）
```

### 9.6.4 例子

```text
例子：复射影空间的层上同调
- H^i(Pⁿ, O(d)) 可以计算
- 当 d ≥ 0 时，除了 H⁰ 外都为零！

这在 射影簇的研究中极其重要！
```

---

## 9.7 局部环空间

### 9.7.1 局部环空间

> **局部环空间** (X, O_X) 是：
> 1. 拓扑空间 X
> 2. 层 O_X，使得每个茎 O_{X,x} 是局部环

```text
例子：
- 复流形（芽是收敛幂级数环）
- 解析空间
- 概形（代数闭域上的局部环空间）
```

### 9.7.2 概形是局部环空间

> **概形（Scheme）** 是局部环空间，局部同构于某环的谱。

> 这就是代数几何的核心定义！

---

## 9.8 层论在代数几何中的应用

> 💡 **核心应用**：
> 
> - **线丛** = 可逆层
> - ** Picard 群** = 同构类可逆层的群
> - ** Čech 上同调** = 计算 H¹ 的工具
> - ** Serre 对偶** = 给出 Hⁿ 与 Hom 的对偶
> - ** 平展上同调** = 韦伊上同调的基础

> 层论是现代代数几何的基石！

---

## 9.9 习题

### 基础题

1. 验证连续函数层满足层的定义

2. 描述层 F 在点 x 的茎的定义

3. 证明：层的核是层

### 进阶题

4. 计算：S¹（圆周）上常数层 ℤ 的层上同调

5. 描述：仿射空间 A¹_k 上的结构层 O_{A¹} 的层上同调

6. 证明：若 F 是平坦层，则 Tor 计算与层上同调可交换

### 挑战题

7. **探索**：
   - 阅读「Godement 消解」
   - 思考：在代数几何中，平展上同调与层上同调有什么区别？

---

## 本章小结

| 概念 | 定义 | 例子 |
|------|------|------|
| 预层 | 开集上的数据 + 限制映射 | 常数预层 |
| 层 | 满足局部性和粘合性的预层 | 连续函数层 |
| 茎 | 点 x 附近的「芽」集合 | O_{X,x} |
| 层态射 | 层的映射 | 结构层态射 |
| 层上同调 | 层的拓扑不变量 | H⁰, H¹, ... |
| 局部环空间 | 茎都是局部环的空间 | 概形、流形 |
| 可逆层 | 局部同构于结构层的层 | 线丛 |

---

## 代数几何伏笔

> 这一章学的层，就是代数几何最核心的工具！
> 
> - **Spec R** 的结构层 O_X
> - **可逆层（线丛）** Pic(X)
> - **层的上同调** 是研究簇几何的关键
> - **导出范畴** D(X) = 层的「最优」范畴
> 
> 我们已经准备好了进入真正的代数几何！

---

## 第三阶段进度

**已完成：**
- ✅ 第八章：范畴论基础
- 🔄 第九章：层论（本章）

**推送更新后继续！**

---

*练习答案见附录*
